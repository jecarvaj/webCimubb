
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard - Dark Admin</title>

    <link rel="stylesheet" type="text/css" href="bootstrap/css/bootstrap.min.css" />
    <link rel="stylesheet" type="text/css" href="font-awesome/css/font-awesome.min.css" />
    <link rel="stylesheet" type="text/css" href="css/local.css" />

    <script type="text/javascript" src="js/Chart.min.js"></script>



    <!-- Agregamos la librería jquery.js desde su repositorio -->

    <script type="text/javascript" src="js/jquery-1.10.2.min.js"></script>


    <script type="text/javascript" src="bootstrap/js/bootstrap.min.js"></script>

    <!-- you need to include the shieldui css and js assets in order for the charts to work -->
    <link rel="stylesheet" type="text/css" href="http://www.shieldui.com/shared/components/latest/css/light-bootstrap/all.min.css" />
    <link id="gridcss" rel="stylesheet" type="text/css" href="http://www.shieldui.com/shared/components/latest/css/dark-bootstrap/all.min.css" />

  <!--  <script type="text/javascript" src="http://www.shieldui.com/shared/components/latest/js/shieldui-all.min.js"></script>-->
    <script type="text/javascript" src="http://www.prepbootstrap.com/Content/js/gridData.js"></script>
    <script src="https://www.gstatic.com/firebasejs/3.3.0/firebase.js"></script>
    <script>
        //vinculamos esta web a firebase para usar db
        var config = {
            apiKey: "AIzaSyBJinA45hwOjeLN3XoczcB8cAzEM0yUeDg",
    authDomain: "chatred-android.firebaseapp.com",
    databaseURL: "https://chatred-android.firebaseio.com",
    storageBucket: "chatred-android.appspot.com",
        };
        firebase.initializeApp(config);
    </script>
</head>
<body style="background-color: #060606;">

<!--<div id="wrapper">-->
    <nav class="navbar navbar-inverse navbar-fixed-top" role="navigation">
        <div class="navbar-header">
            <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-ex1-collapse">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>


            <a class="navbar-brand" href="index.html">CIMUBB</a>



        </div>
        <div class="collapse navbar-collapse navbar-ex1-collapse">

            <ul class="nav navbar-nav navbar-right navbar-user">
                <li class="dropdown messages-dropdown">
                    <a href="#" class="dropdown-toggle" data-toggle="dropdown">  Seleccionar dispositivo  <b class="caret"></b></a>
                    <ul class="dropdown-menu">
                        <li class="message-preview">
                            <a href="#">
                                <span class="message">SCORBOT-ER V</span>
                            </a>
                        </li>
                        <li class="divider"></li>
                        <li class="message-preview">
                            <a href="#">
                                <span class="message">ROBOT X</span>
                            </a>
                        </li>
                        <li class="divider"></li>
                        <li class="message-preview">
                            <a href="#">
                                <span class="message">ROBOT Y</span>
                            </a>
                        </li>

                    </ul>
                </li>

            </ul>
        </div>
    </nav>

        <div id="page-wrapper" style="padding:10px">

            <div class="page-header">

                <h1><i class="fa fa-cogs" aria-hidden="true"></i> Cuentas de encoders</h1>
                <ul class="nav nav-tabs" style="margin-bottom: 10px;">
                    <li class="active"><a href="#encodersTab" data-toggle="tab">Ver en tiempo real</a></li>
                    <li id="pestañaAnalizar"><a href="#analizarTab" data-toggle="tab">Análisis guardados</a></li>
                </ul>

                <div id="myTabContent" class="tab-content">
                    <div class="tab-pane fade active in" id="encodersTab">

                        <div class="row">
                                <div id="content1">
                                    <div id="C1" class="col-lg-3 col-md-3 " >
                                        <div id="PC1"  class="panel panel-primary" >
                                            <div class="panel-heading">
                                                <h3 class="panel-title"><i class="fa fa-bar-chart-o"></i> Encoder 1</h3>
                                            </div>
                                            <div id="panel1" class="panel-body">
                                                <canvas id="grafica1"></canvas>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            <div id="content2">
                                <div id="C2" class="col-lg-3 col-md-3">
                                    <div id="PC2" class="panel panel-primary">
                                        <div class="panel-heading">
                                            <h3 class="panel-title"><i class="fa fa-bar-chart-o"></i> Encoder 2</h3>
                                        </div>
                                        <div id="panel2" class="panel-body">
                                            <canvas id="grafica2"></canvas>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div id="content3">
                                <div id="C3" class="col-lg-3 col-md-3">
                                    <div id="PC3" class="panel panel-primary">
                                        <div class="panel-heading">
                                            <h3 class="panel-title"><i class="fa fa-bar-chart-o"></i> Encoder 3</h3>
                                        </div>
                                        <div id="panel3" class="panel-body">
                                            <canvas id="grafica3"></canvas>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div id="content4">
                                <div id="C4" class="col-lg-3 col-md-3">
                                    <div id="PC4" class="panel panel-primary">
                                        <div class="panel-heading">
                                            <h3 class="panel-title"><i class="fa fa-bar-chart-o"></i> Encoder 4</h3>
                                        </div>
                                        <div  id="panel4"class="panel-body">
                                            <canvas id="grafica4"></canvas>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>



                        <div class="row">
                            <div id="content5">
                                <div id="C5" class="col-lg-3 col-md-3">
                                    <div id="PC5" class="panel panel-primary">
                                        <div  class="panel-heading">
                                            <h3 class="panel-title"><i class="fa fa-bar-chart-o"></i> Encoder 5</h3>
                                        </div>
                                        <div  id="panel5" class="panel-body">
                                            <canvas id="grafica5"></canvas>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div id="content6">
                                <div id="C6" class="col-lg-3 col-md-3">
                                    <div id="PC6" class="panel panel-primary">
                                        <div class="panel-heading">
                                            <h3 class="panel-title"><i class="fa fa-bar-chart-o"></i> Encoder 6</h3>
                                        </div>
                                        <div  id="panel6" class="panel-body">
                                            <canvas id="grafica6"></canvas>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div id="content7">
                                <div id="C7" class="col-lg-3 col-md-3">
                                    <div id="PC7" class="panel panel-primary">
                                        <div class="panel-heading">
                                            <h3 class="panel-title"><i class="fa fa-bar-chart-o"></i> Encoder 7</h3>
                                        </div>
                                        <div  id="panel7" class="panel-body">
                                            <canvas id="grafica7"></canvas>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div id="content8">
                                <div id="C8" class="col-lg-3 col-md-3">
                                    <div id="PC8" class="panel panel-primary">
                                        <div class="panel-heading">
                                            <h3 class="panel-title"><i class="fa fa-bar-chart-o"></i> Encoder 8</h3>
                                        </div>
                                        <div  id="panel8"class="panel-body" >
                                            <canvas id="grafica8"></canvas>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="btn-group">
                            <button type="button" id="btnMonitorear" class="btn btn-success navbar-btn">Monitorear</button>
                            <button type="button" id="btnParar" style="display: none;" class="btn btn-danger navbar-btn">Detener</button>
                            <button type="button" id="btnReiniciar" class=" btn btn-warning navbar-btn">Reiniciar</button>
                        </div>
                    </div>
                    <div class="tab-pane fade" id="analizarTab">
                        <div id="R1" class="row">
                            <div class="form-group col-lg-1">
                                <label>Encoders</label>
                                <div  class="checkbox">
                                    <label>
                                        <input id="CB1" type="checkbox" value="">
                                        Enc 1
                                    </label>
                                </div>
                                <div class="checkbox">
                                    <label>
                                        <input  id="CB2" type="checkbox" value="">
                                        Enc  2
                                    </label>
                                </div>
                                <div class="checkbox">
                                    <label>
                                        <input  id="CB3" type="checkbox" value="">
                                        Enc  3
                                    </label>
                                </div>
                                <div class="checkbox">
                                    <label>
                                        <input id="CB4"  type="checkbox" value="">
                                        Enc  4
                                    </label>
                                </div>
                                <div class="checkbox">
                                    <label>
                                        <input id="CB5"  type="checkbox" value="">
                                        Enc  5
                                    </label>
                                </div>
                                <div class="checkbox">
                                    <label>
                                        <input id="CB6" type="checkbox" value="">
                                        Enc  6
                                    </label>
                                </div>
                                <div class="checkbox">
                                    <label>
                                        <input id="CB7" type="checkbox" value="">
                                        Enc  7
                                    </label>
                                </div>
                                <div class="checkbox">
                                    <label>
                                        <input id="CB8" type="checkbox" value="">
                                        Enc  8
                                    </label>
                                </div>
                            </div>
                            <div class="col-lg-2 ">
                                <form role="form">
                                    <div class="form-group">
                                        <label>Fecha inicio</label>
                                        <input type="date" class="form-control">
                                    </div>

                                    <div class="form-group">
                                        <label>Fecha final</label>
                                        <input type="date" class="form-control" placeholder="Fecha final">
                                    </div>

                                    <div class="form-group">
                                        <label>Seleccionar prueba</label>
                                        <select class="form-control">

                                        </select>
                                    </div>
                                </form>
                                <div class="btn-group">
                                    <button type="button" id="btnGraficar" class="btn btn-success navbar-btn">Gráficar</button>
                                </div>
                            </div>
                            <div class="col-lg-9">
                                <div id="R2" class="row">

                                </div>
                            </div>
                        </div>

                    </div>
                </div>

            </div> <!--fin primera parte encoders, page-header-->

                <div class="page-header">
                    <h1><i class="fa fa-envelope-o" aria-hidden="true"></i> Mensajes</h1>
                    <div class="row">
                        <div class="col-md-6">
                            <div class="panel panel-success">
                                <!-- Default panel contents -->
                                <div class="panel-heading">
                                    <h4><i class="fa fa-cloud-download" aria-hidden="true"></i>
                                         Historial mensajes recibidos
                                    </h4>
                                </div>
                                <div class="panel-body" style="max-height: 450px;overflow-y: scroll;">
                                <!-- Table -->
                                <div class="table-responsive">
                                    <table class="table" id="tablaMensajesRecibidos" >
                                        <thead>
                                        <tr>
                                            <th>Mensaje</th>
                                            <th>Fecha</th>
                                            <th>Hora</th>
                                        </tr>
                                        </thead>
                                        <tbody>

                                        </tbody>
                                    </table>
                                </div>
                                    </div>
                            </div>
                        </div>

                        <div class="col-md-6">
                            <div class="panel panel-warning">
                                <!-- Default panel contents -->
                                <div class="panel-heading">
                                    <h4><i class="fa fa-cloud-upload" aria-hidden="true"></i>
                                        Historial mensajes enviados
                                    </h4>
                                </div>
                                <div class="panel-body" style="max-height: 450px;overflow-y: scroll;">
                                <!-- Table -->
                                <div class="table-responsive">
                                    <table class="table" id="tablaMensajesEnviados">
                                        <thead>
                                        <tr>
                                            <th>Mensaje</th>
                                            <th>Fecha</th>
                                            <th>Hora</th>
                                        </tr>
                                        </thead>
                                        <tbody>

                                        </tbody>
                                    </table>
                                </div>
                                    </div>
                            </div>
                        </div>
                    </div>


                </div><!--fin segunda parte mensajes, page-header-->
</div>     <!-- /#wrapper -->




</body>
<script>
    $( document ).ready(function() {


        var database = firebase.database();
        var referencia = database.ref("encoders");

        //variable para limitar los valores a mostrar en la grafica
        puntos = 0;
        maxPuntos = 120;  //desde la app android a la nube se suben 2 cuentas encoders cada segundo, en 120 puntos sería 1 minuto

        //Script de la grafica
        var ctx = document.getElementById("grafica1").getContext("2d");
        var ctx2 = document.getElementById("grafica2").getContext("2d");
        var ctx3 = document.getElementById("grafica3").getContext("2d");
        var ctx4 = document.getElementById("grafica4").getContext("2d");
        var ctx5 = document.getElementById("grafica5").getContext("2d");
        var ctx6 = document.getElementById("grafica6").getContext("2d");
        var ctx7 = document.getElementById("grafica7").getContext("2d");
        var ctx8 = document.getElementById("grafica8").getContext("2d");

        //Datos iniciales vacíos
        datosIniciales = {
            labels: [0],
            datasets: [
                {
                    //Colores de la grafica
                    fillColor: "transparent",
                    strokeColor: "rgba(220,220,220,1)",
                    pointColor: "transparent",
                    pointStrokeColor: "transparent",
                    data: [0],
                }
            ]
        }

        //Creamos las graficas para cada encoder, se pudo haber hecho de una forma mas eficiente pero no quise.
        //bajé la velocidad de animacion para mejorar el renderizado y que no se pegue
        grafica = new Chart(ctx).Line(datosIniciales, {animationSteps: 1});
        grafica2 = new Chart(ctx2).Line(datosIniciales, {animationSteps: 1});
        grafica3 = new Chart(ctx3).Line(datosIniciales, {animationSteps: 1});
        grafica4 = new Chart(ctx4).Line(datosIniciales, {animationSteps: 1});
        grafica5 = new Chart(ctx5).Line(datosIniciales, {animationSteps: 1});
        grafica6 = new Chart(ctx6).Line(datosIniciales, {animationSteps: 1});
        grafica7 = new Chart(ctx7).Line(datosIniciales, {animationSteps: 1});
        grafica8 = new Chart(ctx8).Line(datosIniciales, {animationSteps: 1});

        var refMensajesRecibidos = database.ref("recibidos").orderByKey();

        //Se ejecuta por cada valor existente en la BD
        //y cada que se agrega un valor nuevo a la base de datos
        refMensajesRecibidos.on("child_added", function (snapshot) {
            //recuperamos una captura del objeto leido
            var recibido = snapshot.val();//t corresponderá a cada elemento dentro del nodo
            $('#tablaMensajesRecibidos').prepend('<tr><td>'+recibido.mensaje+'</td><td>'+recibido.fecha+'</td><td>'+recibido.hora+'</td></tr>');
        });

        var refMensajesEnviados = database.ref("enviados");

        //Se ejecuta por cada valor existente en la BD
        //y cada que se agrega un valor nuevo a la base de datos
        refMensajesEnviados.on("child_added", function (snapshot) {
            //recuperamos una captura del objeto leido
            var enviado = snapshot.val();//t corresponderá a cada elemento dentro del nodo
            $('#tablaMensajesEnviados').prepend('<tr><td>'+enviado.mensaje+'</td><td>'+enviado.fecha+'</td><td>'+enviado.hora+'</td></tr>');
        });

        //Usamos JQuery para detectar clic en el botón
        $('.btnReiniciar').click(function () {


            $('#grafica1').remove();
            $('#panel1').append('<canvas id="grafica1"><canvas>');
            canvas = document.querySelector('#grafica1');
            ctx = canvas.getContext('2d');
            grafica = new Chart(ctx).Line(datosIniciales, {animationSteps: 1});

            $('#grafica2').remove();
            $('#panel2').append('<canvas id="grafica2"><canvas>');
            canvas = document.querySelector('#grafica2');
            ctx2 = canvas.getContext('2d');
            grafica2 = new Chart(ctx2).Line(datosIniciales, {animationSteps: 1});

            $('#grafica3').remove();
            $('#panel3').append('<canvas id="grafica3"><canvas>');
            canvas = document.querySelector('#grafica3');
            ctx3 = canvas.getContext('2d');
            grafica3 = new Chart(ctx3).Line(datosIniciales, {animationSteps: 1});

            $('#grafica4').remove();
            $('#panel4').append('<canvas id="grafica4"><canvas>');
            canvas = document.querySelector('#grafica4');
            ctx4 = canvas.getContext('2d');
            grafica4 = new Chart(ctx4).Line(datosIniciales, {animationSteps: 1});

            $('#grafica5').remove();
            $('#panel5').append('<canvas id="grafica5"><canvas>');
            canvas = document.querySelector('#grafica5');
            ctx5 = canvas.getContext('2d');
            grafica5 = new Chart(ctx5).Line(datosIniciales, {animationSteps: 1});

            $('#grafica6').remove();
            $('#panel6').append('<canvas id="grafica6"><canvas>');
            canvas = document.querySelector('#grafica6');
            ctx6 = canvas.getContext('2d');
            grafica6 = new Chart(ctx6).Line(datosIniciales, {animationSteps: 1});

            $('#grafica7').remove();
            $('#panel7').append('<canvas id="grafica7"><canvas>');
            canvas = document.querySelector('#grafica7');
            ctx7 = canvas.getContext('2d');
            grafica7 = new Chart(ctx7).Line(datosIniciales, {animationSteps: 1});

            $('#grafica8').remove();
            $('#panel8').append('<canvas id="grafica8"><canvas>');
            canvas = document.querySelector('#grafica8');
            ctx8 = canvas.getContext('2d');
            grafica8 = new Chart(ctx8).Line(datosIniciales, {animationSteps: 1});

        });
        $('#btnMonitorear').click(function () {

                        deshabilitar();
            

            first = true;
            referencia.limitToLast(1).on("child_added", function(snap) {
               if( first ) {
                   first = false; 
               } 
               else {
                    var t = snap.val();
                    grafica.addData([t.enc1], "");
                    grafica2.addData([t.enc2], "");
                    grafica3.addData([t.enc3], "");
                    grafica4.addData([t.enc4], "");
                    grafica5.addData([t.enc5], "");
                    grafica6.addData([t.enc6], "");
                    grafica7.addData([t.enc7], "");
                    grafica8.addData([t.enc8], "");
                    puntos++;
                    console.log(puntos);
                    if (puntos > maxPuntos) {
                        grafica.removeData();
                        puntos--;

                    }
                   console.log('new record', snap.val().timestamp);
               }
            });


        });

        

        $('#btnParar').click(function(){
           referencia.off();
            habilitar();
        });

        function habilitar() {
            $('#btnReiniciar').attr("disabled", false);
            $('#pestañaAnalizar').show();
            $('#btnMonitorear').show();
            $('#btnParar').hide();


        }
        function deshabilitar() {
            $('#btnReiniciar').attr("disabled", true);
            $('#btnMonitorear').hide();
            $('#btnParar').show();
            $('#pestañaAnalizar').hide();

        }

        $( '#CB1' ).on( 'click', function() {
            var id=$('#C1');
            if( $(this).is(':checked') ){
                   // var a= $('#C1');
               // console.log(a);
                //$('#R2').append('<div class=\"col-lg-3\">'+a+'</div>');
                id.removeClass('col-lg-3').addClass('col-lg-4');
                $('#R2').append(id);
            }else{
                id.removeClass('col-lg-4').addClass('col-lg-3');
                id.appendTo($('#content1'));
            }
        });

        $( '#CB2' ).on( 'click', function() {
            var id=$('#C2');
            if( $(this).is(':checked') ){

               // $('#R2').append('<div class=\"col-lg-3\">'+a+'</div>');

                id.removeClass('col-lg-3').addClass('col-lg-4');
                $('#R2').append(id);
            }else{
                id.removeClass('col-lg-4').addClass('col-lg-3');
                id.appendTo($('#content2'));
            }
        });
        $( '#CB3' ).on( 'click', function() {
            var id=$('#C3');
            if( $(this).is(':checked') ){
                id.removeClass('col-lg-3').addClass('col-lg-4');
                $('#R2').append(id);
            }else{
                id.removeClass('col-lg-4').addClass('col-lg-3');
                id.appendTo($('#content3'));
            }
        });
        $( '#CB4' ).on( 'click', function() {
            var id=$('#C4');
            if( $(this).is(':checked') ){
                id.removeClass('col-lg-3').addClass('col-lg-4');
                $('#R2').append(id);
            }else{
                id.removeClass('col-lg-4').addClass('col-lg-3');
                id.appendTo($('#content4'));
            }
        });
        $( '#CB5' ).on( 'click', function() {
            var id=$('#C5');
            if( $(this).is(':checked') ){
                id.removeClass('col-lg-3').addClass('col-lg-4');
                $('#R2').append(id);
            }else{
                id.removeClass('col-lg-4').addClass('col-lg-3');
                id.appendTo($('#content5'));
            }
        });
        $( '#CB6' ).on( 'click', function() {
            var id=$('#C6');
            if( $(this).is(':checked') ){
                id.removeClass('col-lg-3').addClass('col-lg-4');
                $('#R2').append(id);
            }else{
                id.removeClass('col-lg-4').addClass('col-lg-3');
               id.appendTo($('#content6'));
            }
        });
        $( '#CB7' ).on( 'click', function() {
            var id=$('#C7');
            if( $(this).is(':checked') ){

                id.removeClass('col-lg-3').addClass('col-lg-4');
                $('#R2').append(id);
            }else{
                id.removeClass('col-lg-4').addClass('col-lg-3');
                id.appendTo($('#content7'));
            }
        });
        $( '#CB8' ).on( 'click', function() {
            var id=$('#C8');
            if( $(this).is(':checked') ){
                id.removeClass('col-lg-3').addClass('col-lg-4');
                $('#R2').append(id);
            }else{
                id.removeClass('col-lg-4').addClass('col-lg-3');
               id.appendTo($('#content8'));
            }
        });

    $('#btnGraficar').click(function(){


    });

    $('#btnPrueba').click(function(){


        var querypruebas = database.ref("pruebaEncoders");
        
        querypruebas.orderByChild("nombre_prueba").equalTo("test2").once("value", function(snapshot) {
            console.log("1");
          console.log(snapshot.val());
        });

        
        querypruebas.orderByChild("nombre_prueba").equalTo("test2").once("value", function(snapshot) {
            console.log("2");
          
            snapshot.forEach(function(data) {
                
                console.log( data.val().encoders.ID147317346056.enc1);
            });


        });

        

    });

     


    });    


</script>
    
    <button type="button" id="btnPrueba">preuba</button>
</html>
